<template>
	<section
		id="snap-slider-wrapper-section"
		ref="snapSliderWrapper"
	>
		<!-- Slides -->
		<div class="snap-content-section">
			<!-- 1 - Slide -->
			<div
				class="snap-element active"
				id="snap-slider-slide-1"
			>
				<div class="se-ui-container">
					<img
						src="@/assets/images/snap/bg.jpg"
						alt="Background Image"
						class="slide-img layer-1"
					/>
					<!-- Moving Cards -->
					<div class="cards-container-3d layer-2">
						<div class="cards-cage">
							<img
								src="@/assets/images/snap/slide_1/card_1.png"
								alt="Card 1"
								class="rotate-card rtc-1 abs-full"
								id="slide-1-rotate-card-1"
							/>
							<img
								src="@/assets/images/snap/slide_1/card_2.png"
								alt="Card 2"
								class="rotate-card rtc-2 abs-full"
								id="slide-1-rotate-card-2"
							/>
							<img
								src="@/assets/images/snap/slide_1/card_3.png"
								alt="Card 3"
								class="rotate-card rtc-3 abs-full"
								id="slide-1-rotate-card-3"
							/>
						</div>
					</div>
					<!-- / Moving Cards -->
					<img
						src="@/assets/images/snap/slide_1/fg_block.png"
						alt="Background Image"
						class="slide-img layer-3"
					/>
					<!-- Sliding Text -->
					<div class="seui-sliding-text-container layer-4">
						<horizontal-text duration="100">
							<div class="h-slide-text white">
								<span>EVENTS</span> <span class="center-dot"></span>
								<span>CONTENT</span> <span class="center-dot"></span>
								<span>DIGITAL</span> <span class="center-dot"></span>
								<span>MEDIA</span> <span class="center-dot"></span>
								<span>EXPERIENCES</span> <span class="center-dot"></span>
							</div>
						</horizontal-text>
					</div>
					<!-- /Sliding Text -->
				</div>
			</div>
			<!-- /1 - Slide -->

			<!-- 2 - Slide -->
			<div
				class="snap-element abs-full"
				id="snap-slider-slide-2"
			>
				<div class="se-ui-container">
					<!-- Background -->
					<img
						src="@/assets/images/snap/bg.jpg"
						alt="Background Image"
						class="slide-img layer-1"
					/>
					<!-- /Background -->

					<!-- Animation Objects -->
					<div class="se-ui-plx-sky-container layer-2">
						<img
							src="@/assets/images/snap/slide_2/cloud.png"
							class="sl2-img-cloud"
							id="slide-2-cloud"
							alt="Clouds"
						>
						<img
							src="@/assets/images/snap/slide_2/gate.png"
							class="sl2-center-main"
							id="slide-2-gate"
							alt="Gate"
						>
						<img
							src="@/assets/images/snap/slide_2/nail.png"
							class="sl2-img-nail"
							alt="Nail"
						>
						<img
							src="@/assets/images/snap/slide_2/rock.png"
							class="sl2-img-rock"
							id="slide-2-rock"
							alt="Rock"
						>
					</div>
					<!-- /Animation Objects -->

					<!-- Sliding Text -->
					<div class="seui-sliding-text-container layer-4">
						<horizontal-text duration="100">
							<div class="h-slide-text white">
								<span>EVENTS</span> <span class="center-dot"></span>
								<span>CONTENT</span> <span class="center-dot"></span>
								<span>DIGITAL</span> <span class="center-dot"></span>
								<span>MEDIA</span> <span class="center-dot"></span>
								<span>EXPERIENCES</span> <span class="center-dot"></span>
							</div>
						</horizontal-text>
					</div>
					<!-- /Sliding Text -->
				</div>
			</div>
			<!-- /2 - Slide -->

			<!-- 3 - Slide -->
			<div
				class="snap-element abs-full"
				id="snap-slider-slide-3"
			>
				<div class="se-ui-container">
					<img
						src="@/assets/images/snap/bg.jpg"
						alt="Background Image"
						class="slide-img layer-1"
					/>
					<div
						class="se-ui-glitch-container layer-2"
						id="slide-3-objects-holder"
					>
						<img
							src="@/assets/images/snap/slide_3/static.jpg"
							alt="Screen"
							class="sl3-img abs-full screen"
						/>
						<div class="sl3-img abs-full glitch-layer"></div>
						<img
							src="@/assets/images/snap/slide_3/frame.png"
							alt="Monitor Frame"
							class="sl3-img abs-full monitor"
						/>
					</div>
					<!-- Sliding Text -->
					<div class="seui-sliding-text-container layer-4">
						<horizontal-text duration="100">
							<div class="h-slide-text white">
								<span>EVENTS</span> <span class="center-dot"></span>
								<span>CONTENT</span> <span class="center-dot"></span>
								<span>DIGITAL</span> <span class="center-dot"></span>
								<span>MEDIA</span> <span class="center-dot"></span>
								<span>EXPERIENCES</span> <span class="center-dot"></span>
							</div>
						</horizontal-text>
					</div>
					<!-- /Sliding Text -->
				</div>
			</div>
			<!-- /3 - Slide -->

			<!-- 4 - Slide -->
			<div
				class="snap-element abs-full"
				id="snap-slider-slide-4"
			>
				<div class="se-ui-container">
					<img
						src="@/assets/images/snap/slide_4/static.jpg"
						alt="Background Image"
						class="slide-img layer-1"
					/>
					<!-- Sliding Text -->
					<div class="seui-sliding-text-container layer-4">
						<horizontal-text duration="100">
							<div class="h-slide-text white">
								<span>EVENTS</span> <span class="center-dot"></span>
								<span>CONTENT</span> <span class="center-dot"></span>
								<span>DIGITAL</span> <span class="center-dot"></span>
								<span>MEDIA</span> <span class="center-dot"></span>
								<span>EXPERIENCES</span> <span class="center-dot"></span>
							</div>
						</horizontal-text>
					</div>
					<!-- /Sliding Text -->
				</div>
			</div>
			<!-- /4 - Slide -->

			<!-- 5 - Slide -->
			<div
				class="snap-element abs-full"
				id="snap-slider-slide-5"
			>
				<div class="se-ui-container">
					<!-- Background -->
					<img
						src="@/assets/images/snap/bg.jpg"
						alt="Background Image"
						class="slide-img layer-1"
					/>
					<!-- /Background -->



					<!-- Animation Objects -->
					<div class="se-ui-plx-sky-container layer-2">
						<div class="typewriter-container abs-full">
							<img
								src="@/assets/images/snap/slide_5/typewriter.png"
								class="sl2-center-main typewriter"
								id="slide-5-typewriter"
								alt="Typewriter"
							>
						</div>
						<img
							src="@/assets/images/snap/slide_2/rock.png"
							class="sl2-img-rock"
							id="slide-5-rock"
							alt="Rock"
						>
					</div>
					<!-- /Animation Objects -->

					<!-- Sliding Text -->
					<div class="seui-sliding-text-container layer-4">
						<horizontal-text duration="100">
							<div class="h-slide-text white">
								<span>EVENTS</span> <span class="center-dot"></span>
								<span>CONTENT</span> <span class="center-dot"></span>
								<span>DIGITAL</span> <span class="center-dot"></span>
								<span>MEDIA</span> <span class="center-dot"></span>
								<span>EXPERIENCES</span> <span class="center-dot"></span>
							</div>
						</horizontal-text>
					</div>
					<!-- /Sliding Text -->
				</div>
			</div>
			<!-- /5 - Slide -->
		</div>
		<!-- /Slides -->

		<!-- Progress -->
		<div class="progress-bars-section">
			<div class="progress-bars-container">
				<!-- 1 - Progress -->
				<div class="pb-progress-holder">
					<div
						class="pb-progress-line"
						id="snap-slider-slide-progress-1"
					></div>
				</div>
				<!-- / 1 - Progress -->

				<!-- 2 - Progress -->
				<div class="pb-progress-holder">
					<div
						class="pb-progress-line"
						id="snap-slider-slide-progress-2"
					></div>
				</div>
				<!-- / 2 - Progress -->

				<!-- 3 - Progress -->
				<div class="pb-progress-holder">
					<div
						class="pb-progress-line"
						id="snap-slider-slide-progress-3"
					></div>
				</div>
				<!-- / 3 - Progress -->

				<!-- 4 - Progress -->
				<div class="pb-progress-holder">
					<div
						class="pb-progress-line"
						id="snap-slider-slide-progress-4"
					></div>
				</div>
				<!-- / 4 - Progress -->

				<!-- 5 - Progress -->
				<div class="pb-progress-holder">
					<div
						class="pb-progress-line"
						id="snap-slider-slide-progress-5"
					></div>
				</div>
				<!-- / 5 - Progress -->
			</div>
		</div>
		<!-- /Progress -->
	</section>
</template>
<script setup>
	const config_pairs = [
		{
			slide: '#snap-slider-slide-1',
			progress: '#snap-slider-slide-progress-1'
		},
		{
			slide: '#snap-slider-slide-2',
			progress: '#snap-slider-slide-progress-2'
		},
		{
			slide: '#snap-slider-slide-3',
			progress: '#snap-slider-slide-progress-3'
		},
		{
			slide: '#snap-slider-slide-4',
			progress: '#snap-slider-slide-progress-4'
		},
		{
			slide: '#snap-slider-slide-5',
			progress: '#snap-slider-slide-progress-5'
		}
	]

	const snapSliderWrapper = ref()
	const secondSlideText = ref()

	let tl;

	onMounted(() => {
		// Initial Setup
		const {
			$ScrollTrigger,
			$gsap,
			$Observer,
			$lenis
		} = useNuxtApp()

		const first = config_pairs[0]
		const second = config_pairs[1]
		const third = config_pairs[2]
		const fourth = config_pairs[3]
		const fifth = config_pairs[4]

		tl = $gsap.timeline({
			defaults: {
				duration: 2
			},
			scrollTrigger: {
				trigger: snapSliderWrapper.value,
				start: 'top top',
				// end: 'bottom top',
				end: '+=25000',
				scrub: 2,
				pin: true,
				pinSpacing: true,
				anticipatePin: 1
			}
		})

		const runSlideTransition = (s1, s2) => {
			const is_going_back = tl.scrollTrigger.direction === -1
			const slide_1 = document.querySelector(s1)
			const slide_2 = document.querySelector(s2)
			if (is_going_back) {
				// Backwards
				slide_1
					.classList.remove('past')
				slide_2
					.classList.remove('active')
				slide_1
					.classList.add('active')
			} else {
				// Forwards
				slide_1
					.classList.remove('active')
				slide_1
					.classList.add('past')
				slide_2
					.classList.add('active')
			}
		}

		const label = {
			1: {
				start: 'slide-1-start',
				end: 'slide-1-end',
			},
			2: {
				start: 'slide-2-start',
				end: 'slide-2-end',
			},
			3: {
				start: 'slide-3-start',
				end: 'slide-3-end',
			},
			4: {
				start: 'slide-4-start',
				end: 'slide-4-end',
			},
			5: {
				start: 'slide-5-start',
				end: 'slide-5-end',
			}
		}

		// Set static values
		tl
			.set('#slide-2-gate', {
				x: '-50%'
			})
			.set('#slide-2-rock', {
				x: '-50%'
			})
			.set('#slide-5-typewriter', {
				x: '-50%'
			})
			.set('#slide-5-rock', {
				x: '-50%'
			})

		// Animation
		tl.

			// First Slide
			add(label[1].start)
			// Slide Animations

			// Card 1
			.to('#slide-1-rotate-card-1', {
				rotateX: 360 * 1.1,
				rotateY: -10,
				rotateZ: -2,
				y: '-93vh',
				x: 200,
			}, label[1].start)

			// Card 2
			.to('#slide-1-rotate-card-2', {
				rotateX: 360 * 0.95,
				rotateY: -15,
				rotateZ: -1,
				y: '-55vh',
				x: -100,
			}, label[1].start)

			// Card 3
			.to('#slide-1-rotate-card-3', {
				rotateX: 360 * 0.92,
				rotateY: 360 * 0.01,
				rotateZ: 50,
				y: '-40vh',
			}, label[1].start)
			// Progress
			.to(
				first.progress,
				{
					width: '100%',
				},
				label[1].start
			)
			// Transition
			.add(() => {
				const { slide: slide_1 } = first
				const { slide: slide_2 } = second
				runSlideTransition(
					slide_1,
					slide_2
				)
			})

			// Second Slide
			.add(label[2].start)

			// Cloud
			.to('#slide-2-cloud', {
				left: '30%'
			}, label[2].start)
			// /Cloud
			// Gate
			.to('#slide-2-gate', {
				scale: 1.3
			}, label[2].start)
			.to('#slide-2-rock', {
				scale: 1.3
			}, label[2].start)
			// /Gate

			.to('#slide-2-cloud', {
				x: '25vw'
			}, label[2].start)

			// Progress
			.to(
				second.progress,
				{
					width: '100%',
				},
				label[2].start
			)
			// Transition
			.add(() => {
				const { slide: slide_1 } = second
				const { slide: slide_2 } = third
				runSlideTransition(
					slide_1,
					slide_2
				)
			})

			// Third Slide
			.add(label[3].start)

			.to('#slide-3-objects-holder', {
				scale: 1.3,
				y: '20%'
			}, label[3].start)

			// Progress
			.to(
				third.progress,
				{
					width: '100%',
				},
				label[3].start
			)
			// Transition
			.add(() => {
				const { slide: slide_1 } = third
				const { slide: slide_2 } = fourth
				runSlideTransition(
					slide_1,
					slide_2
				)
			})

			// Fourth Slide
			.add(label[4].start)

			// Progress
			.to(
				fourth.progress,
				{
					width: '100%',
				},
				label[4].start
			)
			// Transition
			.add(() => {
				const { slide: slide_1 } = fourth
				const { slide: slide_2 } = fifth
				runSlideTransition(
					slide_1,
					slide_2
				)
			})

			// Fifth Slide
			.add(label[5].start)

			// Animations
			.to(
				'#slide-5-typewriter',
				{
					z: 999,
					y: '15vh'
				},
				label[5].start
			)
			.to(
				'#slide-5-rock',
				{
					y: '150%'
				},
				label[5].start
			)

			// Progress
			.to(
				fifth.progress,
				{
					width: '100%',
				},
				label[5].start
			)

	})

	onBeforeUnmount(() => {
		if (tl) {
			tl.kill()
		}
	})
</script>

<style lang="scss" scoped>
	#snap-slider-wrapper-section {
		position: relative;
	}


	.abs-full {
		position: absolute;
		left: 0;
		right: 0;
		top: 0;
		bottom: 0;
		height: 100%;
		width: 100%;
	}

	.snap-content-section {
		position: relative;
		height: 100svh;
		z-index: 1;
	}

	.snap-element {
		transform: translateY(100%);
		transition: all 0.5s ease-in-out;

		&.active {
			transform: translateY(0);
		}

		&.past {
			opacity: 0;
			transform: translateY(-100%)
		}

		.se-ui-container {
			height: 100svh;
			width: 100svw;
			position: relative;

			// 3D in the first slide
			.cards-container-3d {
				position: absolute;
				left: 0;
				right: 0;
				top: 0;
				bottom: 0;

				// flex
				// display: flex;
				// justify-content: center;
				// align-items: flex-end;

				.cards-cage {
					position: absolute;
					left: 50%;
					top: 100%;
					transform: translate(-50%, -50%);

					width: 400px;
					height: 280px;
					position: relative;
					perspective-origin: top;
					perspective: 1700px;
					transform-style: preserve-3d;

					.rotate-card {
						display: block;
						margin: 0;
						backface-visibility: visible;

						object-fit: cover;

						&.rtc-1 {
							transform: translate3d(100px, 0, -200px)
						}

						&.rtc-2 {
							transform: translate3d(-100px, 300px, 0);
						}

						&.rtc-3 {
							transform: translate3d(250px, 500px, -400px)
						}
					}
				}
			}

			.seui-sliding-text-container {
				position: absolute;
				bottom: 120px;
				left: 0;
				right: 0;
				color: white;
				transition: all 0.5s ease-in-out;


				&:hover {
					transform: scale(1.05);
					transform-origin: center;

					span {
						color: rgba(255, 255, 255, 0.1);
						// backdrop-filter: blur(5px);
					}

					span.center-dot::after {
						background: rgba(255, 255, 255, 0.1);
						border: 2px solid white;
					}
				}

				.h-slide-text {
					font-size: 200px;
					opacity: 1;

					span {
						-webkit-text-stroke: 2px white;
						transition: all 0.5s ease-in-out;

						&::after {
							transition: all 0.5s ease-in-out;
						}
					}
				}
			}

			// Slide 2
			.se-ui-plx-sky-container {
				position: absolute;
				left: 0;
				top: 0;
				z-index: 2;
				height: 100%;
				width: 100%;

				img {
					position: absolute;
					left: 0;
					// top: 0;

					&.sl2-img-cloud {
						height: 60vh;
						top: 10vh;
					}

					&.sl2-center-main {
						height: 85vh;
						top: unset;
						bottom: 0;
						left: 50%;
						transform: translate(-50%, 0);

						&.typewriter {
							bottom: 15vh;
							height: 60vh;
						}
					}

					&.sl2-img-nail {
						opacity: 0;
					}

					&.sl2-img-rock {
						height: 30vh;
						top: unset;
						bottom: -7vh;
						left: 50%;
						// transform: translate(-50%, 0) rotateZ(-3deg);
					}
				}
			}

			// Slide 3
			.se-ui-glitch-container {
				position: absolute;
				left: 0;
				right: 0;
				top: 0;
				bottom: 0;

				overflow: hidden;

				.sl3-img {
					object-fit: cover;

					&.screen {
						transform: scale(1.01)
					}
				}

				.glitch-layer {
					background-image: url(@/assets/images/snap/slide_3/glitch.webp);
					background-size: 700px;
					opacity: 0.4;
					mix-blend-mode: color;
				}
			}

			// Slide 4

			.typewriter-container {
				transform-style: preserve-3d;
				transform-origin: center;
				perspective: 1000px;
				overflow: hidden;
			}


			.layer-1 {
				z-index: 1;
			}

			.layer-2 {
				z-index: 2;
			}

			.layer-3 {
				z-index: 3;
			}

			.layer-4 {
				z-index: 4;
			}

			.slide-img {
				position: absolute;
				left: 0;
				bottom: 0;
				width: 100%;
				height: 100%;
				object-fit: cover;
				display: block;

				&.mv-card {
					left: 50%;
					bottom: 0;
					height: 200px;
					width: 300px;

					&.mvc-1 {
						// transform:
						// 	translate(-38px, -324px) rotateX(48deg) rotateY(10deg)
					}

					&.mvc-2 {
						// transform:
						// 	translate(-300px, -462px) rotateX(18deg) rotateY(-20deg);
					}

					&.mvc-3 {
						// transform: translate(-409px, -225px) rotateX(34deg) rotateY(-24deg)
					}
				}
			}

			h1 {
				font-size: 45vw;
				color: #ffffff24;
				text-align: center;
				margin: 0;
				line-height: calc(100vh - 115px);
				text-transform: uppercase;
				font-weight: 900;
				text-align: center;
			}
		}

		z-index: 0;
	}


	// Progress

	.progress-bars-section {
		position: absolute;
		left: 0;
		right: 0;
		bottom: 30px;
		width: 100%;
		padding-bottom: 80px;
		z-index: 2;
		overflow: hidden;
	}

	.progress-bars-container {
		display: flex;
		justify-content: space-between;
		flex-wrap: nowrap;
		margin: 0 -13px;
		padding: 0 100px;
	}

	.pb-progress-holder {
		height: 5px;
		box-sizing: border-box;
		border-radius: 2px;
		background: #ffffff33;
		overflow: hidden;
		flex: 1;
		margin: 0 13px;
	}

	.pb-progress-line {
		height: 100%;
		width: 0%;
		box-sizing: border-box;
		background: white;
	}
</style>